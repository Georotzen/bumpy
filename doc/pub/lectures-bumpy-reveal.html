<!DOCTYPE html>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="A worked example on scientific computing with Python">

<title>A worked example on scientific computing with Python</title>







<!-- reveal.js: http://lab.hakim.se/reveal-js/ -->

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<!--
<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/beigesmall.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/solarized.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/serif.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/moon.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/default.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/cbc.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simula.css" id="theme">
-->

<!-- For syntax highlighting -->
<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

<!-- If the query includes 'print-pdf', use the PDF print sheet -->
<script>
document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
</script>

<style type="text/css">
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p.caption { width: 80%; font-size: 60%; font-style: italic; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .reveal .alert-text-small   { font-size: 80%;  }
    .reveal .alert-text-large   { font-size: 130%; }
    .reveal .alert-text-normal  { font-size: 90%;  }
    .reveal .alert {
             padding:8px 35px 8px 14px; margin-bottom:18px;
             text-shadow:0 1px 0 rgba(255,255,255,0.5);
             border:5px solid #bababa;
             -webkit-border-radius: 14px; -moz-border-radius: 14px;
             border-radius:14px
             background-position: 10px 10px;
             background-repeat: no-repeat;
             background-size: 38px;
             padding-left: 30px; /* 55px; if icon */
     }
     .reveal .alert-block {padding-top:14px; padding-bottom:14px}
     .reveal .alert-block > p, .alert-block > ul {margin-bottom:1em}
     /*.reveal .alert li {margin-top: 1em}*/
     .reveal .alert-block p+p {margin-top:5px}
     /*.reveal .alert-notice { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_notice.png); }
     .reveal .alert-summary  { background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_summary.png); }
     .reveal .alert-warning { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_warning.png); }
     .reveal .alert-question {background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_question.png); } */

</style>



<!-- Styles for table layout of slides -->
<style type="text/css">
td.padding {
  padding-top:20px;
  padding-bottom:20px;
  padding-right:50px;
  padding-left:50px;
}
</style>

</head>

<body>
<div class="reveal">

<!-- Any section element inside the <div class="slides"> container
     is displayed as a slide -->

<div class="slides">





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    



<section>
<!-- ------------------- main content ---------------------- -->



<center><h1 style="text-align: center;">A worked example on scientific computing with Python</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2] (<tt>hpl at simula.no</tt>)
</center>


<p>&nbsp;<br>
<!-- institution(s) -->

<center>[1] <b>Simula Research Laboratory</b></center>
<center>[2] <b>University of Oslo</b></center>
<p>&nbsp;<br>
<center><h4>Jan 15, 2015</h4></center> <!-- date -->
<p>

</section>


<section>

<h2>Table of contents</h2>

<p>
&nbsp; &nbsp; &nbsp; <a href="#___sec0"> Contents </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec1"> The following programming topics are illustrated </a><br>
<a href="#___sec2"> A scientific application </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec3"> Physical problem and mathematical model </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec4"> Numerical model </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec5"> Extension to quadratic damping </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec6"> Simple implementation </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec7"> Using the function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec8"> Plot </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec9"> More advanced implementation (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec10"> More advanced implementation (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec11"> Important features </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec12"> Using the solver function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec13"> Local vs global variables </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec14"> Advanced programming of functions with parameters </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec15"> The excitation force </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec16"> Computing the force from the road profile </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec17"> Vectorized version of the previous function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec18"> Performing the simulation of vibrations </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec19"> A high-level solve function (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec20"> A high-level solve function (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec21"> Computing an expression for the noise level of the vibrations </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec22"> Pickling objects to file </a><br>
<a href="#___sec23"> User input </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec24"> Positional command-line arguments </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec25"> Option-value pairs on the command line </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec26"> Example on using <code>argparse</code> </a><br>
<a href="#___sec27"> Visual exploration </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec28"> Code (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec29"> Code (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec30"> Code (part III) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec31"> Plot of the spectrum </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec32"> Code (part IV) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec33"> Plot </a><br>
<a href="#___sec34"> Advanced topics </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec35"> Symbolic computing via SymPy </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec36"> Go seamlessly from symbolic expression to Python function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec37"> Testing via test functions and test frameworks </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec38"> Example on a test function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec39"> Test function for the numerical solver (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec40"> Test function for the numerical solver (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec41"> Using a test framework </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec42"> Modules </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec43"> Example on a module file </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec44"> What gets imported? </a><br>
</p>
<p>

</section>


<section>

<h2 id="___sec0">Contents </h2>

<p>
This worked example

<ul>
  <p><li> fetches a data file from a web site,</li>
  <p><li> applies that file as input data for a differential equation modeling a vibrating system,</li>
  <p><li> solves the equation by a finite difference method,</li>
  <p><li> visualizes various properties of the solution and the input data.</li>
</ul>
<p>


</section>


<section>

<h2 id="___sec1">The following programming topics are illustrated </h2>

<ul>
  <p><li> basic Python constructs: variables, loops, if-tests, arrays, functions</li>
  <p><li> flexible storage of objects in lists</li>
  <p><li> storage of objects in files (persistence)</li>
  <p><li> downloading files from the web</li>
  <p><li> user input via the command line</li>
  <p><li> signal processing and FFT</li>
  <p><li> curve plotting of data</li>
  <p><li> testing</li>
  <p><li> modules</li>
</ul>
<p>

All files can be forked at <a href="https://github.com/hplgit/bumpy" target="_blank"><tt>https://github.com/hplgit/bumpy</tt></a>

<p>

</section>


<section>

<h2>Table of contents</h2>

<p>
&nbsp; &nbsp; &nbsp; <a href="#___sec0"> Contents </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec1"> The following programming topics are illustrated </a><br>
<a href="#___sec2"> A scientific application </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec3"> Physical problem and mathematical model </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec4"> Numerical model </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec5"> Extension to quadratic damping </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec6"> Simple implementation </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec7"> Using the function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec8"> Plot </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec9"> More advanced implementation (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec10"> More advanced implementation (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec11"> Important features </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec12"> Using the solver function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec13"> Local vs global variables </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec14"> Advanced programming of functions with parameters </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec15"> The excitation force </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec16"> Computing the force from the road profile </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec17"> Vectorized version of the previous function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec18"> Performing the simulation of vibrations </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec19"> A high-level solve function (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec20"> A high-level solve function (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec21"> Computing an expression for the noise level of the vibrations </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec22"> Pickling objects to file </a><br>
<a href="#___sec23"> User input </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec24"> Positional command-line arguments </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec25"> Option-value pairs on the command line </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec26"> Example on using <code>argparse</code> </a><br>
<a href="#___sec27"> Visual exploration </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec28"> Code (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec29"> Code (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec30"> Code (part III) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec31"> Plot of the spectrum </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec32"> Code (part IV) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec33"> Plot </a><br>
<a href="#___sec34"> Advanced topics </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec35"> Symbolic computing via SymPy </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec36"> Go seamlessly from symbolic expression to Python function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec37"> Testing via test functions and test frameworks </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec38"> Example on a test function </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec39"> Test function for the numerical solver (part I) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec40"> Test function for the numerical solver (part II) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec41"> Using a test framework </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec42"> Modules </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec43"> Example on a module file </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec44"> What gets imported? </a><br>
</p>
<p>

</section>


<section>

<h1 id="___sec2">A scientific application </h1>

<p>
<center><p><img src="fig-bumpy/bumpy_road1.jpg" align="bottom" width=400></p></center>

<p>

</section>


<section>

<h2 id="___sec3">Physical problem and mathematical model </h2>

<p>&nbsp;<br>
$$
\begin{equation}
mu'' + f(u') + s(u) = F(t),\quad u(0)=I,\ u'(0)=V
\tag{1}
\end{equation}
$$
<p>&nbsp;<br>


<ul>
 <p><li> Input: mass \( m \), friction force \( f(u') \), spring \( s(u) \), external
   forcing \( F(t) \), \( I \), \( V \)</li>
 <p><li> Output: vertical displacement \( u(t) \)</li>
</ul>
<p>

<center><p><img src="fig-bumpy/vehicle2.png" align="bottom" width=500></p></center>

<p>

</section>


<section>

<h2 id="___sec4">Numerical model </h2>

<ul>
 <p><li> Finite difference method</li>
 <p><li> Centered differences</li>
 <p><li> \( u^n \): approximation to exact \( u \) at \( t=t_n=n\Delta t \)</li>
 <p><li> First: linear damping</li>
</ul>
<p>

<p>&nbsp;<br>
$$
\begin{equation*}
u^{n+1} = \left(2mu^n + (\frac{b}{2}\Delta t - m)u^{n-1} +
\Delta t^2(F^n - s(u^n))
\right)(m + \frac{b}{2}\Delta t)^{-1}
\end{equation*}
$$
<p>&nbsp;<br>


<p>
A special formula must be applied for \( n=0 \):

<p>&nbsp;<br>
$$
\begin{equation*}
u^1 = u^0 + \Delta t\, V
+ \frac{\Delta t^2}{2m}(-bV - s(u^0) + F^0)
\end{equation*}
$$
<p>&nbsp;<br>


<p>

</section>


<section>

<h2 id="___sec5">Extension to quadratic damping </h2>

<p>
Linearization via geometric mean:

<p>&nbsp;<br>
$$
f(u'(t_n)) = \left. |u'|u'\right\vert^n \approx |u'|^{n-\frac{1}{2}}
(u')^{n+\frac{1}{2}}
$$
<p>&nbsp;<br>


<p>&nbsp;<br>
$$
\begin{align*}
u^{n+1} = & \left( m + b|u^n-u^{n-1}|\right)^{-1}\times \\ 
&\quad \left(2m u^n - mu^{n-1} + bu^n|u^n-u^{n-1}| + \Delta t^2 (F^n - s(u^n))
\right)
\end{align*}
$$
<p>&nbsp;<br>


<p>
(and again a special formula for \( u^1 \))

<p>

</section>


<section>

<h2 id="___sec6">Simple implementation </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">solver_linear_damping</span><span style="color: #d0d0d0">(I,</span> <span style="color: #d0d0d0">V,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">F,</span> <span style="color: #d0d0d0">t):</span>
    <span style="color: #d0d0d0">N</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t.size</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span>              <span style="color: #999999; font-style: italic"># No of time intervals</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>            <span style="color: #999999; font-style: italic"># Time step</span>
    <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">zeros(N+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>              <span style="color: #999999; font-style: italic"># Result array</span>
    <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">I</span>
    <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt*V</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">/(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m)*(-b*V</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">F[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span>

    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">n</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,N):</span>
        <span style="color: #d0d0d0">u[n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.</span><span style="color: #d0d0d0">/(m</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">b*dt/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">)*(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m*u[n]</span> <span style="color: #d0d0d0">+</span> \ 
                 <span style="color: #d0d0d0">(b*dt/</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">m)*u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*(F[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[n])))</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">u</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec7">Using the function </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">solver</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">solver_linear_damping</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">s</span><span style="color: #d0d0d0">(u):</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u</span>

<span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">10</span><span style="color: #d0d0d0">*pi</span>      <span style="color: #999999; font-style: italic"># simulate for t in [0,T]</span>
<span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.2</span>
<span style="color: #d0d0d0">N</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">round</span><span style="color: #d0d0d0">(T/dt))</span>
<span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">T,</span> <span style="color: #d0d0d0">N+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">F</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">zeros(t.size)</span>
<span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">V</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
<span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.2</span>
<span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver_linear_damping(I,</span> <span style="color: #d0d0d0">V,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">F,</span> <span style="color: #d0d0d0">t)</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #d0d0d0">plot(t,</span> <span style="color: #d0d0d0">u)</span>
<span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp.pdf&#39;</span><span style="color: #d0d0d0">)</span>   <span style="color: #999999; font-style: italic"># save plot to PDF file</span>
<span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp.png&#39;</span><span style="color: #d0d0d0">)</span>   <span style="color: #999999; font-style: italic"># save plot to PNG file</span>
<span style="color: #d0d0d0">show()</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec8">Plot </h2>

<p>
<center><p><img src="fig-bumpy/solver_linear_damping.png" align="bottom" width=500></p></center>

<p>

</section>


<section>

<h2 id="___sec9">More advanced implementation (part I) </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">solver</span><span style="color: #d0d0d0">(I,</span> <span style="color: #d0d0d0">V,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">F,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">damping=</span><span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Solve m*u&#39;&#39; + f(u&#39;) + s(u) = F for time points in t.</span>
<span style="color: #ed9d13">    u(0)=I and u&#39;(0)=V,</span>
<span style="color: #ed9d13">    by a central finite difference method with time step dt.</span>
<span style="color: #ed9d13">    If damping is &#39;linear&#39;, f(u&#39;)=b*u, while if damping is</span>
<span style="color: #ed9d13">    &#39;quadratic&#39;, we have f(u&#39;)=b*u&#39;*abs(u&#39;).</span>
<span style="color: #ed9d13">    s(u) is a Python function, while F may be a function</span>
<span style="color: #ed9d13">    or an array (then F[i] corresponds to F at t[i]).</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #d0d0d0">N</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t.size</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span>              <span style="color: #999999; font-style: italic"># No of time intervals</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>            <span style="color: #999999; font-style: italic"># Time step</span>
    <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(N+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>           <span style="color: #999999; font-style: italic"># Result array</span>
    <span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(b);</span> <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(m)</span>  <span style="color: #999999; font-style: italic"># Avoid integer division</span>

    <span style="color: #999999; font-style: italic"># Convert F to array</span>
    <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #24909d">callable</span><span style="color: #d0d0d0">(F):</span>
        <span style="color: #d0d0d0">F</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">F(t)</span>
    <span style="color: #6ab825; font-weight: bold">elif</span> <span style="color: #24909d">isinstance</span><span style="color: #d0d0d0">(F,</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">list</span><span style="color: #d0d0d0">,</span><span style="color: #24909d">tuple</span><span style="color: #d0d0d0">,np.ndarray)):</span>
        <span style="color: #d0d0d0">F</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.asarray(F)</span>
    <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
        <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">TypeError</span><span style="color: #d0d0d0">(</span>
            <span style="color: #ed9d13">&#39;F must be function or array, not %s&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">(F))</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec10">More advanced implementation (part II) </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">solver</span><span style="color: #d0d0d0">(I,</span> <span style="color: #d0d0d0">V,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">F,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">damping=</span><span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">...</span>
    <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">I</span>
    <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">:</span>
        <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt*V</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">/(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m)*(-b*V</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">F[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span>
    <span style="color: #6ab825; font-weight: bold">elif</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;quadratic&#39;</span><span style="color: #d0d0d0">:</span>
        <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt*V</span> <span style="color: #d0d0d0">+</span> \ 
               <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">/(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m)*(-b*V*</span><span style="color: #24909d">abs</span><span style="color: #d0d0d0">(V)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">F[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span>
    <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
        <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">ValueError</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;Wrong value: damping=&quot;%s&quot;&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">damping)</span>

    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">n</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,N):</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">u[n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m*u[n]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">(b*dt/</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">m)*u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span>
                      <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*(F[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[n])))/(m</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">b*dt/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">elif</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;quadratic&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">u[n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m*u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">m*u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">b*u[n]*</span><span style="color: #24909d">abs</span><span style="color: #d0d0d0">(u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
                      <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*(s(u[n])</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">F[n]))/</span>\ 
                      <span style="color: #d0d0d0">(m</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">b*</span><span style="color: #24909d">abs</span><span style="color: #d0d0d0">(u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]))</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec11">Important features </h2>

<ul>
 <p><li> Two types of import: <code>import module</code> vs <code>from module import function</code></li>
 <p><li> Doc strings for documentation</li>
 <p><li> Avoiding integer division</li>
 <p><li> Flexible variable type: <code>F</code> can be function or array</li>
 <p><li> Checking correct variable type</li>
</ul>
<p>


</section>


<section>

<h2 id="___sec12">Using the solver function </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">sin,</span> <span style="color: #d0d0d0">pi</span>  <span style="color: #999999; font-style: italic"># for nice math</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">solver</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">solver</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">F</span><span style="color: #d0d0d0">(t):</span>
    <span style="color: #999999; font-style: italic"># Sinusoidal bumpy road</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">A*sin(pi*t)</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">s</span><span style="color: #d0d0d0">(u):</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">k*u</span>

<span style="color: #d0d0d0">A</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.25</span>
<span style="color: #d0d0d0">k</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>
<span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">20</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2001</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver(I=</span><span style="color: #3677a9">0.1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">V=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">m=</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">b=</span><span style="color: #3677a9">0.05</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">s=s,</span> <span style="color: #d0d0d0">F=F,</span> <span style="color: #d0d0d0">t=t)</span>

<span style="color: #999999; font-style: italic"># Show u(t) as a curve plot</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">plt</span>
<span style="color: #d0d0d0">plt.plot(t,</span> <span style="color: #d0d0d0">u)</span>
<span style="color: #d0d0d0">plt.show()</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec13">Local vs global variables </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">f</span><span style="color: #d0d0d0">(u):</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">k*u</span>
</pre></div>
<p>
Here,

<ul>
  <p><li> <code>u</code> is a <em>local variable</em>,
    which is accessible just inside in the function</li>
  <p><li> <code>k</code> is a <em>global variable</em>, which must be initialized outside
    the function prior to calling <code>f</code></li>
</ul>
<p>


</section>


<section>

<h2 id="___sec14">Advanced programming of functions with parameters </h2>

<ul>
 <p><li> \( f(u)=ku \) needs parameter \( k \)</li>
 <p><li> Implement \( f \) as a class with \( k \) as attribute and <code>__call__</code>
   for evaluating <code>f(u)</code></li>
</ul>
<p>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Spring</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">k):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.k</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">k</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">u):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.k*u</span>

<span style="color: #d0d0d0">f</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Spring(k)</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec15">The excitation force </h2>

<ul>
 <p><li> Bumpy road gives an excitation</li>
 <p><li> <a href="http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz" target="_blank"><tt>http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz</tt></a></li>
 <p><li> File contains various road profiles</li>
</ul>
<p>

Download road profile data from the Internet:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">filename</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;bumpy.dat.gz&#39;</span>
<span style="color: #d0d0d0">url</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">urllib</span>
<span style="color: #d0d0d0">urllib.urlretrieve(url,</span> <span style="color: #d0d0d0">filename)</span>
<span style="color: #d0d0d0">h_data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.loadtxt(filename)</span>     <span style="color: #999999; font-style: italic"># read numpy array from file</span>

<span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h_data[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,:]</span>                <span style="color: #999999; font-style: italic"># 1st column: x coordinates</span>
<span style="color: #d0d0d0">h_data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h_data[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">:,:]</span>          <span style="color: #999999; font-style: italic"># other columns: h shapes</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec16">Computing the force from the road profile </h2>

<p>&nbsp;<br>
$$ F(t) \sim  h''(t) $$
<p>&nbsp;<br>


<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">acceleration</span><span style="color: #d0d0d0">(h,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">v):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;Compute 2nd-order derivative of h.&quot;&quot;&quot;</span>
    <span style="color: #999999; font-style: italic"># Method: standard finite difference aproximation</span>
    <span style="color: #d0d0d0">d2h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(h.size)</span>
    <span style="color: #d0d0d0">dx</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">x[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">h.size-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">):</span>
        <span style="color: #d0d0d0">d2h[i]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(h[i-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*h[i]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">h[i+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])/dx**</span><span style="color: #3677a9">2</span>
    <span style="color: #999999; font-style: italic"># Extraplolate end values from first interior value</span>
    <span style="color: #d0d0d0">d2h[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d2h[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">d2h[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d2h[-</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d2h*v**</span><span style="color: #3677a9">2</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">a</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec17">Vectorized version of the previous function </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">acceleration_vectorized</span><span style="color: #d0d0d0">(h,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">v):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;Compute 2nd-order derivative of h. Vectorized version.&quot;&quot;&quot;</span>
    <span style="color: #d0d0d0">d2h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(h.size)</span>
    <span style="color: #d0d0d0">dx</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">x[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">d2h[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">:-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(h[:-</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*h[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">:-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">h[</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">:])/dx**</span><span style="color: #3677a9">2</span>
    <span style="color: #999999; font-style: italic"># Extraplolate end values from first interior value</span>
    <span style="color: #d0d0d0">d2h[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d2h[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">d2h[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d2h[-</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">d2h*v**</span><span style="color: #3677a9">2</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">a</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec18">Performing the simulation of vibrations </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[x,</span> <span style="color: #d0d0d0">t]</span>      <span style="color: #999999; font-style: italic"># key input and output data (arrays)</span>
<span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(h_data.shape[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]):</span>
    <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h_data[i,:]</span>            <span style="color: #999999; font-style: italic"># extract a column</span>
    <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">acceleration(h,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">v)</span>
    <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">forced_vibrations(t=t,</span> <span style="color: #d0d0d0">I=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">m=m,</span> <span style="color: #d0d0d0">b=b,</span> <span style="color: #d0d0d0">f=f,</span> <span style="color: #d0d0d0">F=-m*a)</span>
    <span style="color: #d0d0d0">data.append([h,</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">u])</span>
</pre></div>
<p>
Parameters for bicycle conditions: \( m=60 \) kg, \( v=5 \) m/s, \( k=60 \) N/m,
\( b=80 \) Ns/m

<p>

</section>


<section>

<h2 id="___sec19">A high-level solve function (part I) </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">solve</span><span style="color: #d0d0d0">(url=</span><span style="color: #24909d">None</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">m=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">b=</span><span style="color: #3677a9">80</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">k=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">v=</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Solve model for verticle vehicle vibrations.</span>

<span style="color: #ed9d13">    =========   ==============================================</span>
<span style="color: #ed9d13">    variable    description</span>
<span style="color: #ed9d13">    =========   ==============================================</span>
<span style="color: #ed9d13">    url         either URL of file with excitation force data,</span>
<span style="color: #ed9d13">                or name of a local file</span>
<span style="color: #ed9d13">    m           mass of system</span>
<span style="color: #ed9d13">    b           friction parameter</span>
<span style="color: #ed9d13">    k           spring parameter</span>
<span style="color: #ed9d13">    v           (constant) velocity of vehicle</span>
<span style="color: #ed9d13">    Return      data (list) holding input and output data</span>
<span style="color: #ed9d13">                [x, t, [h,a,u], [h,a,u], ...]</span>
<span style="color: #ed9d13">    =========   ==============================================</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #999999; font-style: italic"># Download file (if url is not the name of a local file)</span>
    <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">url.startswith(</span><span style="color: #ed9d13">&#39;http://&#39;</span><span style="color: #d0d0d0">)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #d0d0d0">url.startswith(</span><span style="color: #ed9d13">&#39;file://&#39;</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">urllib</span>
        <span style="color: #d0d0d0">filename</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">os.path.basename(url)</span>  <span style="color: #999999; font-style: italic"># strip off path</span>
        <span style="color: #d0d0d0">urllib.urlretrieve(url,</span> <span style="color: #d0d0d0">filename)</span>
    <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
        <span style="color: #999999; font-style: italic"># Check if url is the name of a local file</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">os.path.isfile(url):</span>
            <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">url,</span> <span style="color: #ed9d13">&#39;must be a URL or a filename&#39;</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">sys.exit(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec20">A high-level solve function (part II) </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">solve</span><span style="color: #d0d0d0">(url=</span><span style="color: #24909d">None</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">m=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">b=</span><span style="color: #3677a9">80</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">k=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">v=</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">...</span>
    <span style="color: #d0d0d0">h_data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.loadtxt(filename)</span>  <span style="color: #999999; font-style: italic"># read numpy array from file</span>

    <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h_data[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,:]</span>                <span style="color: #999999; font-style: italic"># 1st column: x coordinates</span>
    <span style="color: #d0d0d0">h_data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h_data[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">:,:]</span>          <span style="color: #999999; font-style: italic"># other columns: h shapes</span>

    <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x/v</span>                        <span style="color: #999999; font-style: italic"># time corresponding to x</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">f</span><span style="color: #d0d0d0">(u):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">k*u</span>

    <span style="color: #d0d0d0">data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[x,</span> <span style="color: #d0d0d0">t]</span>      <span style="color: #999999; font-style: italic"># key input and output data (arrays)</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(h_data.shape[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]):</span>
        <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h_data[i,:]</span>            <span style="color: #999999; font-style: italic"># extract a column</span>
        <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">acceleration(h,</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">v)</span>

        <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">forced_vibrations(t=t,</span> <span style="color: #d0d0d0">I=</span><span style="color: #3677a9">0.2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">m=m,</span> <span style="color: #d0d0d0">b=b,</span> <span style="color: #d0d0d0">f=f,</span> <span style="color: #d0d0d0">F=-m*a)</span>
        <span style="color: #d0d0d0">data.append([h,</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">u])</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">data</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec21">Computing an expression for the noise level of the vibrations </h2>

<p>&nbsp;<br>
$$ \mbox{RMS} = \sqrt{\int_0^T u^2dt} \approx \sqrt{\frac{1}{N+1}\sum_{i=0}^N (u^n)^2}$$
<p>&nbsp;<br>


<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">rms</span><span style="color: #d0d0d0">(data):</span>
    <span style="color: #d0d0d0">u_rms</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.zeros(t.size)</span>  <span style="color: #999999; font-style: italic"># for accumulating the rms value</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">h,</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">u</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">data[</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">:]:</span>  <span style="color: #999999; font-style: italic"># loop over results</span>
        <span style="color: #d0d0d0">u_rms</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">u**</span><span style="color: #3677a9">2</span>
    <span style="color: #d0d0d0">u_rms</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.sqrt(u_rms/u_rms.size)</span>
    <span style="color: #d0d0d0">data.append(u_rms)</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">data</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec22">Pickling objects to file </h2>

<p>
After calling

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">road_url</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
<span style="color: #d0d0d0">data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solve(url=road_url,</span>
             <span style="color: #d0d0d0">m=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">b=</span><span style="color: #3677a9">200</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">k=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">v=</span><span style="color: #3677a9">6</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">rms(data)</span>
</pre></div>
<p>
the <code>data</code> array contains single arrays and triplets of arrays,

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">[x,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">[h,a,u],</span> <span style="color: #d0d0d0">[h,a,u],</span> <span style="color: #d0d0d0">...,</span> <span style="color: #d0d0d0">[h,a,u],</span> <span style="color: #d0d0d0">u_rms]</span>
</pre></div>
<p>
This list, or any Python object, can be stored on file for later
retrieval of the results, using <em>pickling</em>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">cPickle</span>
<span style="color: #d0d0d0">outfile</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">open</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;bumpy.res&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;w&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">cPickle.dump(data,</span> <span style="color: #d0d0d0">outfile)</span>
<span style="color: #d0d0d0">outfile.close()</span>
</pre></div>
<p>
See <a href="https://github.com/hplgit/bumpy/blob/master/doc/src/src-bumpy/bumpy.py" target="_blank"><tt>bumpy.py</tt></a>.

<p>

</section>


<section>

<h1 id="___sec23">User input </h1>

<p>
<center><p><img src="fig-bumpy/input2.jpg" align="bottom" width=500></p></center>

<p>

</section>


<section>

<h2 id="___sec24">Positional command-line arguments </h2>

<p>
Suppose \( b \) is given on the command line:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%">Terminal&gt; python bumpy.py 10
</pre></div>
<p>
Code:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">try</span><span style="color: #d0d0d0">:</span>
    <span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(sys.argv[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
<span style="color: #6ab825; font-weight: bold">except</span> <span style="color: #bbbbbb">IndexError</span><span style="color: #d0d0d0">:</span>
    <span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">80</span>  <span style="color: #999999; font-style: italic"># default</span>
</pre></div>
<p>
Note: 1st command-line argument in <code>sys.argv[1]</code>, but that is a string

<p>

</section>


<section>

<h2 id="___sec25">Option-value pairs on the command line </h2>

<p>
Now we want to use option-value pairs on the command line:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%">Terminal&gt; python bumpy.py --m 40 --b 280
</pre></div>
<p>
Note:

<ul>
 <p><li> All parameters have default values</li>
 <p><li> The default value can be overridden on the command line with
   <code>--option value</code></li>
 <p><li> We use the <code>argparse</code> module for defining, reading, and accessing
   option-value pairs</li>
</ul>
<p>


</section>


<section>

<h2 id="___sec26">Example on using <code>argparse</code> </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">command_line_options</span><span style="color: #d0d0d0">():</span>
    <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">argparse</span>
    <span style="color: #d0d0d0">parser</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">argparse.ArgumentParser()</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--m&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;--mass&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span>
                        <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">help=</span><span style="color: #ed9d13">&#39;mass of vehicle&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--k&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;--spring&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span>
                        <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">help=</span><span style="color: #ed9d13">&#39;spring parameter&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--b&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;--damping&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span>
                        <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">80</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">help=</span><span style="color: #ed9d13">&#39;damping parameter&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--v&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;--velocity&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span>
                        <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">help=</span><span style="color: #ed9d13">&#39;velocity of vehicle&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">url</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--roadfile&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">str</span><span style="color: #d0d0d0">,</span>
              <span style="color: #d0d0d0">default=url,</span> <span style="color: #d0d0d0">help=</span><span style="color: #ed9d13">&#39;filename/URL with road data&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">args</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">parser.parse_args()</span>
    <span style="color: #999999; font-style: italic"># Extract input parameters</span>
    <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">args.m;</span> <span style="color: #d0d0d0">k</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">args.k;</span> <span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">args.b;</span> <span style="color: #d0d0d0">v</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">args.v</span>
    <span style="color: #d0d0d0">url</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">args.roadfile</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">url,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">k,</span> <span style="color: #d0d0d0">v</span>
</pre></div>
<p>

</section>


<section>

<h1 id="___sec27">Visual exploration </h1>

<p>
Plot

<ul>
 <p><li> the root mean square value of \( u(t) \), to see the typical amplitudes</li>
 <p><li> the spectrum of \( u(t) \), for \( t>t_s \) (using FFT) to see which frequencies
   that dominate in the signal</li>
 <p><li> for each road shape, a plot of \( h(x) \), \( a(t) \), and \( u(t) \), for
   \( t\geq t_s \)</li>
</ul>
<p>


</section>


<section>

<h2 id="___sec28">Code (part I) </h2>

<p>
For convenience:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
</pre></div>
<p>
Loading results from file:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">cPickle</span>
<span style="color: #d0d0d0">outfile</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">open</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;bumpy.res&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;r&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">cPickle.load(outfile)</span>
<span style="color: #d0d0d0">outfile.close()</span>

<span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">data[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">]</span>
<span style="color: #d0d0d0">u_rms</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">data[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span>
</pre></div>
<p>
Recall list <code>data</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">[x,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">[h,a,u],</span> <span style="color: #d0d0d0">[h,a,u],</span> <span style="color: #d0d0d0">...,</span> <span style="color: #d0d0d0">[h,a,u],</span> <span style="color: #d0d0d0">u_rms]</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec29">Code (part II) </h2>

<p>
Display only the last portion of time series:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">indices</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">&gt;=</span> <span style="color: #d0d0d0">t_s</span>   <span style="color: #999999; font-style: italic"># True/False boolean array</span>
<span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[indices]</span>       <span style="color: #999999; font-style: italic"># fetch the part of t for which t &gt; t_s</span>
<span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x[indices]</span>       <span style="color: #999999; font-style: italic"># fetch the part of x for which t &gt; t_s</span>
</pre></div>
<p>
Plotting the root mean square value array <code>u_rms</code> for <code>t &gt;= t_s</code> is now done by

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">figure()</span>
<span style="color: #d0d0d0">u_rms</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u_rms[indices]</span>
<span style="color: #d0d0d0">plot(t,</span> <span style="color: #d0d0d0">u_rms)</span>
<span style="color: #d0d0d0">legend([</span><span style="color: #ed9d13">&#39;u&#39;</span><span style="color: #d0d0d0">])</span>
<span style="color: #d0d0d0">xlabel(</span><span style="color: #ed9d13">&#39;t&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">title(</span><span style="color: #ed9d13">&#39;Root mean square value of u(t) functions&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">show()</span>
</pre></div>
<p>
<center><p><img src="fig-bumpy/u_rms.png" align="bottom" width=300></p></center>

<p>

</section>


<section>

<h2 id="___sec30">Code (part III) </h2>

<p>
The spectrum of a discrete function \( u(t) \):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">frequency_analysis</span><span style="color: #d0d0d0">(u,</span> <span style="color: #d0d0d0">t):</span>
    <span style="color: #d0d0d0">A</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">fft(u)</span>
    <span style="color: #d0d0d0">A</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*A</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">N</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t.size</span>
    <span style="color: #d0d0d0">freq</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">arange(N/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">dtype=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">)/N/dt</span>
    <span style="color: #d0d0d0">A</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(A[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">:freq.size])/N</span>
    <span style="color: #999999; font-style: italic"># Remove small high frequency part</span>
    <span style="color: #d0d0d0">tol</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.05</span><span style="color: #d0d0d0">*A.max()</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">xrange</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(A)-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">A[i]</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #d0d0d0">tol:</span>
            <span style="color: #6ab825; font-weight: bold">break</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">freq[:i+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">A[:i+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span>

<span style="color: #d0d0d0">figure()</span>
<span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">data[</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">][</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">][indices]</span>  <span style="color: #999999; font-style: italic"># 2nd realization of u</span>
<span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">A</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">frequency_analysis(u,</span> <span style="color: #d0d0d0">t)</span>
<span style="color: #d0d0d0">plot(f,</span> <span style="color: #d0d0d0">A)</span>
<span style="color: #d0d0d0">title(</span><span style="color: #ed9d13">&#39;Spectrum of u&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">show()</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec31">Plot of the spectrum </h2>

<p>
<center><p><img src="fig-bumpy/u_spectrum.png" align="bottom" width=600></p></center>

<p>

</section>


<section>

<h2 id="___sec32">Code (part IV) </h2>

<p>
Run through all the 3-lists <code>[h, a, u]</code> and plot
these arrays:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">case_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
<span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">h,</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">u</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">data[</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">:-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]:</span>
    <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h[indices]</span>
    <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">a[indices]</span>
    <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[indices]</span>

    <span style="color: #d0d0d0">figure()</span>
    <span style="color: #d0d0d0">subplot(</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">plot(x,</span> <span style="color: #d0d0d0">h,</span> <span style="color: #ed9d13">&#39;g-&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">legend([</span><span style="color: #ed9d13">&#39;h %d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">case_counter])</span>
    <span style="color: #d0d0d0">hmax</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">abs</span><span style="color: #d0d0d0">(h.max())</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(h.min()))/</span><span style="color: #3677a9">2</span>
    <span style="color: #d0d0d0">axis([x[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">x[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">-hmax*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">hmax*</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">])</span>
    <span style="color: #d0d0d0">xlabel(</span><span style="color: #ed9d13">&#39;distance&#39;</span><span style="color: #d0d0d0">);</span> <span style="color: #d0d0d0">ylabel(</span><span style="color: #ed9d13">&#39;height&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #d0d0d0">subplot(</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">plot(t,</span> <span style="color: #d0d0d0">a)</span>
    <span style="color: #d0d0d0">legend([</span><span style="color: #ed9d13">&#39;a %d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">case_counter])</span>
    <span style="color: #d0d0d0">xlabel(</span><span style="color: #ed9d13">&#39;t&#39;</span><span style="color: #d0d0d0">);</span> <span style="color: #d0d0d0">ylabel(</span><span style="color: #ed9d13">&#39;acceleration&#39;</span><span style="color: #d0d0d0">)</span>

    <span style="color: #d0d0d0">subplot(</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">3</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">plot(t,</span> <span style="color: #d0d0d0">u,</span> <span style="color: #ed9d13">&#39;r-&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">legend([</span><span style="color: #ed9d13">&#39;u %d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">case_counter])</span>
    <span style="color: #d0d0d0">xlabel(</span><span style="color: #ed9d13">&#39;t&#39;</span><span style="color: #d0d0d0">);</span> <span style="color: #d0d0d0">ylabel(</span><span style="color: #ed9d13">&#39;displacement&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp%d.png&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">case_counter)</span>
    <span style="color: #d0d0d0">case_counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec33">Plot </h2>

<p>
<center><p><img src="fig-bumpy/hau0.png" align="bottom" width=700></p></center>

<p>
See <a href="https://github.com/hplgit/bumpy/blob/master/doc/src/src-bumpy/explore.py" target="_blank"><tt>explore.py</tt></a>

<p>

</section>


<section>

<h1 id="___sec34">Advanced topics </h1>

<p>
<center><p><img src="fig-bumpy/rocket_science1.gif" align="bottom" width=400></p></center>

<p>

</section>


<section>

<h2 id="___sec35">Symbolic computing via SymPy </h2>

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">sympy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">sp</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sp.symbols(</span><span style="color: #ed9d13">&#39;x a&#39;</span><span style="color: #d0d0d0">)</span>        <span style="color: #999999; font-style: italic"># Define mathematical symbols</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">Q</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">a*x**</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span>                  <span style="color: #999999; font-style: italic"># Quadratic function</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">dQdx</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sp.diff(Q,</span> <span style="color: #d0d0d0">x)</span>            <span style="color: #999999; font-style: italic"># Differentiate wrt x</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">dQdx</span>
<span style="color: #3677a9">2</span><span style="color: #d0d0d0">*a*x</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">Q2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sp.integrate(dQdx,</span> <span style="color: #d0d0d0">x)</span>      <span style="color: #999999; font-style: italic"># Integrate (no constant)</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">Q2</span>
<span style="color: #d0d0d0">a*x**</span><span style="color: #3677a9">2</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">Q2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sp.integrate(Q,</span> <span style="color: #d0d0d0">(x,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">a))</span> <span style="color: #999999; font-style: italic"># Definite integral</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">Q2</span>
<span style="color: #d0d0d0">a**</span><span style="color: #3677a9">4</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">3</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">a</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">roots</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sp.solve(Q,</span> <span style="color: #d0d0d0">x)</span>          <span style="color: #999999; font-style: italic"># Solve Q = 0 wrt x</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">roots</span>
<span style="color: #d0d0d0">[-sqrt(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">/a),</span> <span style="color: #d0d0d0">sqrt(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">/a)]</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec36">Go seamlessly from symbolic expression to Python function </h2>

<p>
Convert a SymPy expression <code>Q</code> into
a Python function <code>Q(x, a)</code>:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">Q</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sp.lambdify([x,</span> <span style="color: #d0d0d0">a],</span> <span style="color: #d0d0d0">Q)</span>      <span style="color: #999999; font-style: italic"># Turn Q into Py func.</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">Q(x=</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">a=</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">)</span>                     <span style="color: #999999; font-style: italic"># 3*2**2 - 1 = 11</span>
<span style="color: #3677a9">11</span>
</pre></div>
<p>
This <code>Q(x, a)</code> function can be used for numerical computing

<p>

</section>


<section>

<h2 id="___sec37">Testing via test functions and test frameworks </h2>

<p>
Modern test frameworks:

<ul>
 <p><li> <a href="https://nose.readthedocs.org/" target="_blank">nose</a></li>
 <p><li> <a href="http://pytest.org/latest/" target="_blank">pytest</a></li>
</ul>
<p>

Recommendation: use pytest, stay away from <code>unittest</code>

<p>

</section>


<section>

<h2 id="___sec38">Example on a test function </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">halve</span><span style="color: #d0d0d0">(x):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;Return half of x.&quot;&quot;&quot;</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x/</span><span style="color: #3677a9">2.0</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">test_halve</span><span style="color: #d0d0d0">():</span>
    <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">4</span>
    <span style="color: #d0d0d0">expected</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>
    <span style="color: #d0d0d0">computed</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">halve(x)</span>
    <span style="color: #999999; font-style: italic"># Compare real numbers using tolerance</span>
    <span style="color: #d0d0d0">tol</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1E-14</span>
    <span style="color: #d0d0d0">diff</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(computed</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">expected)</span>
    <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #d0d0d0">diff</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">tol</span>
</pre></div>
<p>
Note:

<ul>
 <p><li> Name starts with <code>test_*</code></li>
 <p><li> No arguments</li>
 <p><li> Must have <code>assert</code> on a boolean expression for passed test</li>
</ul>
<p>


</section>


<section>

<h2 id="___sec39">Test function for the numerical solver (part I) </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">lhs_eq</span><span style="color: #d0d0d0">(t,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">damping=</span><span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;Return lhs of differential equation as sympy expression.&quot;&quot;&quot;</span>
    <span style="color: #d0d0d0">v</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sm.diff(u,</span> <span style="color: #d0d0d0">t)</span>
    <span style="color: #d0d0d0">d</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">b*v</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;linear&#39;</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">b*v*sm.Abs(v)</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">m*sm.diff(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">t)</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">d</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s(u)</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">test_solver</span><span style="color: #d0d0d0">():</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;Verify linear/quadratic solution.&quot;&quot;&quot;</span>
    <span style="color: #999999; font-style: italic"># Set input data for the test</span>
    <span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.2</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">V</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">3</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.9</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">k</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">4</span>
    <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">lambda</span> <span style="color: #d0d0d0">u:</span> <span style="color: #d0d0d0">k*u</span>
    <span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.2</span>
    <span style="color: #d0d0d0">N</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">round</span><span style="color: #d0d0d0">(T/dt))</span>
    <span style="color: #d0d0d0">time_points</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">T,</span> <span style="color: #d0d0d0">N+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

    <span style="color: #999999; font-style: italic"># Test linear damping</span>
    <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sm.Symbol(</span><span style="color: #ed9d13">&#39;t&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">q</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>  <span style="color: #999999; font-style: italic"># arbitrary constant</span>
    <span style="color: #d0d0d0">u_exact</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">V*t</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">q*t**</span><span style="color: #3677a9">2</span>   <span style="color: #999999; font-style: italic"># sympy expression</span>
    <span style="color: #d0d0d0">F_term</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lhs_eq(t,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">u_exact,</span> <span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #ed9d13">&#39;Fitted source term, linear case:&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">F_term</span>
    <span style="color: #d0d0d0">F</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sm.lambdify([t],</span> <span style="color: #d0d0d0">F_term)</span>
    <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t_</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver(I,</span> <span style="color: #d0d0d0">V,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">F,</span> <span style="color: #d0d0d0">time_points,</span> <span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">u_e</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sm.lambdify([t],</span> <span style="color: #d0d0d0">u_exact,</span> <span style="color: #d0d0d0">modules=</span><span style="color: #ed9d13">&#39;numpy&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">error</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(u_e(t_)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u).max()</span>
    <span style="color: #d0d0d0">tol</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1E-13</span>
    <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #d0d0d0">error</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">tol</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec40">Test function for the numerical solver (part II) </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">test_solver</span><span style="color: #d0d0d0">():</span>
    <span style="color: #d0d0d0">...</span>
    <span style="color: #999999; font-style: italic"># Test quadratic damping: u_exact must be linear</span>
    <span style="color: #d0d0d0">u_exact</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">V*t</span>
    <span style="color: #d0d0d0">F_term</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">lhs_eq(t,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">u_exact,</span> <span style="color: #ed9d13">&#39;quadratic&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #ed9d13">&#39;Fitted source term, quadratic case:&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">F_term</span>
    <span style="color: #d0d0d0">F</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sm.lambdify([t],</span> <span style="color: #d0d0d0">F_term)</span>
    <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t_</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver(I,</span> <span style="color: #d0d0d0">V,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">F,</span> <span style="color: #d0d0d0">time_points,</span> <span style="color: #ed9d13">&#39;quadratic&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">u_e</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sm.lambdify([t],</span> <span style="color: #d0d0d0">u_exact,</span> <span style="color: #d0d0d0">modules=</span><span style="color: #ed9d13">&#39;numpy&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">error</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(u_e(t_)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u).max()</span>
    <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #d0d0d0">error</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">tol</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec41">Using a test framework </h2>

<p>
Examine all subdirectories <code>test*</code> for <code>test_*.py</code> files:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%">Terminal&gt; py.test -s
====================== test session starts =======================
...
collected 3 items

tests/test_bumpy.py .
Fitted source term, linear case: 8*t**2 + 15.6*t + 15.5
Fitted source term, quadratic case: 12*t + 12.9
testing solver
testing solver_linear_damping_wrapper

==================== 3 passed in 0.40 seconds ====================
</pre></div>
<p>
Test a single file:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%">Terminal&gt; py.test -s tests/test_bumpy.py
...
</pre></div>
<p>

</section>


<section>

<h2 id="___sec42">Modules </h2>

<ul>
 <p><li> Put functions in a file - that is a module</li>
 <p><li> Move main program to a function</li>
 <p><li> Use a test block for executable code (call to main function)</li>
</ul>
<p>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">__name__</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;__main__&#39;</span><span style="color: #d0d0d0">:</span>
    <span style="color: #d0d0d0">&lt;statements</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">the</span> <span style="color: #d0d0d0">main</span> <span style="color: #d0d0d0">program&gt;</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec43">Example on a module file </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">module1</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">module2</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">somefunc1,</span> <span style="color: #d0d0d0">somefunc2</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">myfunc1</span><span style="color: #d0d0d0">(...):</span>
    <span style="color: #d0d0d0">...</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">myfunc2</span><span style="color: #d0d0d0">(...):</span>
    <span style="color: #d0d0d0">...</span>

<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">__name__</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;__main__&#39;</span><span style="color: #d0d0d0">:</span>
    <span style="color: #d0d0d0">&lt;statements</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">the</span> <span style="color: #d0d0d0">main</span> <span style="color: #d0d0d0">program&gt;</span>
</pre></div>
<p>

</section>


<section>

<h2 id="___sec44">What gets imported? </h2>

<p>
Import everything from the previous module:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">mymod</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
</pre></div>
<p>
This imports

<ul>
 <p><li> <code>module1</code>, <code>somefunc1</code>, <code>somefunc2</code> (global names in <code>mymod</code>)</li>
 <p><li> <code>myfunc1</code>, <code>myfunc2</code> (global functions in <code>mymod</code>)</li>
</ul>
<p>



</section>



</div> <!-- class="slides" -->
</div> <!-- class="reveal" -->

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.min.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

    // Display navigation controls in the bottom right corner
    controls: true,

    // Display progress bar (below the horiz. slider)
    progress: true,

    // Display the page number of the current slide
    slideNumber: true,

    // Push each slide change to the browser history
    history: false,

    // Enable keyboard shortcuts for navigation
    keyboard: true,

    // Enable the slide overview mode
    overview: true,

    // Vertical centering of slides
    //center: true,
    center: false,

    // Enables touch navigation on devices with touch input
    touch: true,

    // Loop the presentation
    loop: false,

    // Change the presentation direction to be RTL
    rtl: false,

    // Turns fragments on and off globally
    fragments: true,

    // Flags if the presentation is running in an embedded mode,
    // i.e. contained within a limited portion of the screen
    embedded: false,

    // Number of milliseconds between automatically proceeding to the
    // next slide, disabled when set to 0, this value can be overwritten
    // by using a data-autoslide attribute on your slides
    autoSlide: 0,

    // Stop auto-sliding after user input
    autoSlideStoppable: true,

    // Enable slide navigation via mouse wheel
    mouseWheel: false,

    // Hides the address bar on mobile devices
    hideAddressBar: true,

    // Opens links in an iframe preview overlay
    previewLinks: false,

    // Transition style
    transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

    // Transition speed
    transitionSpeed: 'default', // default/fast/slow

    // Transition style for full page slide backgrounds
    backgroundTransition: 'default', // default/none/slide/concave/convex/zoom

    // Number of slides away from the current that are visible
    viewDistance: 3,

    // Parallax background image
    //parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

    // Parallax background size
    //parallaxBackgroundSize: '' // CSS syntax, e.g. "2100px 900px"

    theme: Reveal.getQueryHash().theme, // available themes are in reveal.js/css/theme
    transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

});

Reveal.initialize({
    dependencies: [
        // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
        { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },

        // Interpret Markdown in <section> elements
        { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },

        // Syntax highlight for <code> elements
        { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

        // Zoom in and out with Alt+click
        { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },

        // Speaker notes
        { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },

        // Remote control your reveal.js presentation using a touch device
        //{ src: 'reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } },

        // MathJax
        //{ src: 'reveal.js/plugin/math/math.js', async: true }
    ]
});

Reveal.initialize({

    // The "normal" size of the presentation, aspect ratio will be preserved
    // when the presentation is scaled to fit different resolutions. Can be
    // specified using percentage units.
    width: 1170,  // original: 960,
    height: 700,

    // Factor of the display size that should remain empty around the content
    margin: 0.1,

    // Bounds for smallest/largest possible scale to apply to content
    minScale: 0.2,
    maxScale: 1.0

});
</script>

<!-- begin footer logo
<div style="position: absolute; bottom: 0px; left: 0; margin-left: 0px">
<img src="somelogo.png">
</div>
     end footer logo -->



</body>
</html>
